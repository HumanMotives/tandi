<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Loop Grave</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      background-color: #f5f1e6;
      font-family: 'Georgia', serif;
      color: #333;
      max-width: 800px;
      margin: 4rem auto;
      padding: 0 1.5rem;
    }

    .logo-container {
      text-align: center;
      margin-bottom: 2rem;
    }

    .logo-container img {
      max-width: 100%;
      height: auto;
    }

    hr {
      border: none;
      border-top: 1px solid #ccc;
      margin: 2rem 0;
    }

    .upload-box {
      border: 1px dashed #aaa;
      padding: 2rem;
      text-align: center;
      background-color: #fffefa;
      cursor: pointer;
      margin-bottom: 2rem;
    }

    .hidden { display: none; }

    .progress-bar {
      width: 100%;
      background-color: #e1ddd1;
      border: 1px solid #ccc;
      height: 20px;
      margin-top: 1rem;
    }

    .progress-fill {
      height: 100%;
      width: 0;
      background-color: #70695d;
      transition: width 5s linear;
    }

    .button {
      display: block;
      margin: 1.5rem auto 0.5rem auto;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      background-color: #3a3a3a;
      color: #fff;
      cursor: pointer;
    }

    .link {
      display: block;
      margin-top: 1rem;
      text-align: center;
      color: #555;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .ceremony {
      margin-top: 2rem;
    }

    .tombstone {
      margin-top: 2rem;
      padding: 2rem;
      border: 2px solid #555;
      background-color: #f1f1ee;
      text-align: center;
      font-family: monospace;
      opacity: 0;
      transition: opacity 2s ease-in;
    }

    .tombstone.show {
      opacity: 1;
    }

    .options-afterlife {
      margin-top: 2rem;
      text-align: center;
      font-size: 0.95rem;
    }

    .graveyard {
      border-top: 1px solid #ccc;
      margin-top: 3rem;
      padding-top: 2rem;
    }

    .graveyard table {
      width: 100%;
      font-family: monospace;
      font-size: 0.95rem;
      border-collapse: collapse;
    }

    .graveyard th, .graveyard td {
      text-align: left;
      padding: 0.3rem 0.5rem;
      border-bottom: 1px solid #ddd;
    }

    .fade-in {
      animation: fadeIn 2s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    input[type="text"] {
      margin-top: 1rem;
      margin-bottom: 1rem;
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #aaa;
      font-size: 1rem;
    }

    #sarcasticRemark {
      font-family: monospace;
      font-style: normal;
      font-size: 1rem;
    }

    footer {
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      margin-top: 4rem;
    }
  </style>
</head>
<body>

  <div class="logo-container">
    <img src="datagrave_sitelogo_large.png" alt="The Loop Grave Logo">
  </div>

  <hr>

  <div style="text-align:center; margin-bottom: 1rem;">
    <label><input type="radio" name="method" value="bury" checked> Bury</label>
    <label style="margin-left:1rem;"><input type="radio" name="method" value="cremate"> Cremate</label>
  </div>

  <div class="upload-box" id="uploadBox" onclick="document.getElementById('fileInput').click()">
    Click or drag a file here to begin its final journey.<br>
    <small>(audio files only)</small>
    <input type="file" id="fileInput" class="hidden" accept="audio/*">
  </div>

  <div id="progressContainer" class="hidden">
    <p id="progressMessage">Analyzing file...</p>
    <div class="progress-bar">
      <div class="progress-fill" id="analyzeFill"></div>
    </div>
  </div>

  <div id="ceremony" class="ceremony"></div>

  <div class="graveyard">
    <h3>ðŸª¦ Recently Buried</h3>
    <table>
      <thead><tr><th>Filename</th><th>Date of Burial</th></tr></thead>
      <tbody id="graveList"></tbody>
    </table>
  </div>

  <footer>
    <div class="donate-widget" style="margin-bottom:15px;">
      <script src="https://storage.ko-fi.com/cdn/widget/Widget_2.js"></script>
      <script>
        kofiwidget2.init('Support me on Ko-fi', '#242524', 'V7V01ICB2V');
        kofiwidget2.draw();
      </script>
    </div>
    Concept &amp; Design by Chris van der Linden. Licensed under
    <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
  </footer>

  <script>
    const fileInput = document.getElementById('fileInput');
    const progressContainer = document.getElementById('progressContainer');
    const analyzeFill = document.getElementById('analyzeFill');
    const ceremony = document.getElementById('ceremony');
    const graveList = document.getElementById('graveList');

    const sarcasticRemarks = [
      "We see why this one didn't make the cut...",
      "Not the prettiest indeed.",
      "Some loops die so others may live.",
      "This one had... potential.",
      "The DAW giveth, and the DAW taketh away."
    ];

    const eulogies = [
      "You were nearly something.",
      "Not every loop is meant to bloom.",
      "Goodbye, noble rhythm.",
      "You served your time in the grid.",
      "Rest well, unnamed arpeggio.",
      "Your fade-out is eternal.",
      "No need for a drop, only peace."
    ];

    const ashesSamples = ["ashes1.mp3", "ashes2.mp3", "ashes3.mp3"];

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;

      progressContainer.classList.remove('hidden');
      analyzeFill.style.width = '0';
      setTimeout(() => analyzeFill.style.width = '100%', 50);

      setTimeout(() => {
        progressContainer.classList.add('hidden');
        const method = document.querySelector('input[name="method"]:checked').value;
        const fileName = file.name;
        const truncatedName = fileName.length > 40 ? fileName.substring(0, 37) + '...' : fileName;
        const birthDate = new Date(file.lastModified).toLocaleDateString();
        const deathDate = new Date().toLocaleDateString();
        const quote = eulogies[Math.floor(Math.random() * eulogies.length)];
        const snark = sarcasticRemarks[Math.floor(Math.random() * sarcasticRemarks.length)];

        const tombstone = document.createElement('div');
        tombstone.className = 'tombstone';
        tombstone.innerHTML = `
          ðŸª¦<br><strong>RIP</strong><br>
          ${truncatedName}<br>
          ${birthDate} â€” ${deathDate}<br><br>
          "${quote}"<br><br>
          <em style="font-family:monospace">"${snark}"</em><br>
          <div class="options-afterlife">
            <p>Wish to collect the remains?</p>
            <button onclick="playAshes()">Check the remains</button>
            <br><br>
            <audio id="ashesAudio" controls class="hidden"></audio>
            <p style="margin-top:1rem;">
              <a href="#" onclick="document.getElementById('notifyForm').classList.toggle('hidden')">Notify next of kin</a> |
              <a href="#donate">Make a donation to the church</a>
            </p>
            <div id="notifyForm" class="hidden">
              <input type="email" placeholder="Enter email address"><br>
              <button>Send Eulogy</button>
            </div>
          </div>
          <div class="link" onclick="location.reload()">Bury another loop</div>
        `;

        ceremony.innerHTML = '';
        ceremony.appendChild(tombstone);
        setTimeout(() => tombstone.classList.add('show'), 50);

        const tr = document.createElement('tr');
        tr.classList.add('fade-in');
        tr.innerHTML = `<td>${truncatedName}</td><td>${new Date().toLocaleString()}</td>`;
        graveList.prepend(tr);
      }, 5000);
    });

    function playAshes() {
      const audio = document.getElementById('ashesAudio');
      const sample = ashesSamples[Math.floor(Math.random() * ashesSamples.length)];
      audio.src = sample;
      audio.classList.remove('hidden');
      audio.play();
    }
  </script>
</body>
</html>
