<!-- CUT FOR LENGTH, PARTIAL VIEW SHOWN -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabase = supabase.createClient(
      'https://ticxhncusdycqjftohho.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpY3hobmN1c2R5Y3FqZnRvaGhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMTg1MzksImV4cCI6MjA2ODY5NDUzOX0.z2KXaX0dv0ucLmC2ctL51vumhx3xuLcV-2ZL8UFbcxM'
    );

    async function recordBurial(name, method, epitaph) {
      await supabase.from('burials').insert([
        {
          name,
          method,
          epitaph,
          timestamp: new Date().toISOString()
        }
      ]);
    }

    async function loadBurials() {
      const { data, error } = await supabase
        .from('burials')
        .select('*')
        .order('timestamp', { ascending: false });

      if (data) {
        data.forEach(b => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${b.name}</td><td>${new Date(b.timestamp).toLocaleString()}</td>`;
          tr.classList.add('fade-in');
          graveList.appendChild(tr);
        });
      }
    }

    document.addEventListener('DOMContentLoaded', loadBurials);
  </script>

<!-- REST OF YOUR SCRIPT AND HTML BODY CONTINUES -->

    function showCeremony() {
      const now = new Date();
      const name = selectedFile.name;
      const displayName = name.length > 40 ? name.substring(0, 37) + '...' : name;
      const birthDate = new Date(selectedFile.lastModified).toLocaleDateString();
      const deathDate = now.toLocaleDateString();
      const epitaph = document.getElementById('epitaph').value.trim() || "Gone, but never exported.";
      const selectedMethod = document.querySelector('input[name=\"method\"]:checked').value;

      // âœ… Store in Supabase
      recordBurial(displayName, selectedMethod, epitaph);

      const tombstone = document.createElement('div');
      tombstone.className = 'tombstone';
      tombstone.innerHTML = `
        ðŸª¦<br><strong>RIP</strong><br>
        ${displayName}<br>
        ${birthDate} â€” ${deathDate}<br><br>
        "${epitaph}"
      `;
      ceremony.innerHTML = '';
      ceremony.appendChild(tombstone);
      setTimeout(() => tombstone.classList.add('show'), 50);

      aftercare.classList.remove('hidden');

      const tr = document.createElement('tr');
      tr.classList.add('fade-in');
      tr.innerHTML = `<td>${displayName}</td><td>${now.toLocaleString()}</td>`;
      graveList.prepend(tr);
    }

<!-- END OF SCRIPT -->

