<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transients &amp; Incantations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200&display=swap" rel="stylesheet">
  <style>
    /* Page background */
    body {
      margin: 0;
      background: #DCEEDD;       /* your solid background color */
      font-family: 'Inter', sans-serif;
      font-weight: 200;
      color: #474350;
      text-align: center;
      padding: 20px;
    }

    /* Header & Logo */
    .header {
      max-width: 800px;
      margin: 0 auto 20px;
    }
    .header img {
      width: 100%;
      height: auto;
      display: block;
      margin-bottom: 10px;
    }
    .tagline {
      font-size: 1em;
      color: #666;
      margin-bottom: 30px;
    }

    /* Mode selector */
    .mode-options {
      margin-bottom: 20px;
    }
    .mode-options label {
      font-size: 1.1em;
      margin: 0 15px;
    }
    input[type="radio"] {
      accent-color: #474350;
    }

    /* Generate button */
    #generateBtn {
      background-color: #242524;
      color: #f7fff4;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      margin: 10px 0;
      font-size: 1em;
      cursor: pointer;
    }
    #generateBtn:hover {
      background-color: #3a3b3a;
    }

    /* Idea box */
    #idea-box {
      background: #FCFFEB;       /* light panel color */
      border-radius: 20px;
      max-width: 700px;
      margin: 20px auto;
      padding: 40px 20px;
      position: relative;
    }
    #idea {
      font-family: 'Courier New', Courier, monospace;  /* typewriter vibe */
      font-size: 1.3em;
      line-height: 1.6;
      white-space: normal;
      overflow-wrap: break-word;
      word-wrap: break-word;
      hyphens: auto;
      min-height: 3em;
      margin-bottom: 20px;
    }

    /* Action buttons inside idea box */
    .actions {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .actions button {
      border: none;
      border-radius: 5px;
      padding: 10px 16px;
      font-size: 1.2em;
      cursor: pointer;
    }
    /* Share button style */
    #shareBtn {
      background: #FECDAA;
      color: #474350;
    }
    #shareBtn:hover {
      background: #e0c29a;
    }
    /* Copy button style */
    #copyBtn {
      background: #474350;
      color: #F8FFF4;
    }
    #copyBtn:hover {
      background: #2e2d2f;
    }

    /* Character fade animation */
    @keyframes fadeInChars {
      from { opacity: 0; transform: translateY(0.2em); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .char {
      display: inline;
      opacity: 0;
      animation: fadeInChars .4s forwards;
      margin-right: .05em;
      white-space: pre;
      color: #474350;
    }

    /* Footer card */
    footer {
      color: #474350;
      max-width: 700px;
      margin: 40px auto 0;
      padding: 20px;
      border-radius: 8px;
      font-size: .8em;
    }
    footer a {
      color: #474350;
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <!-- Header with wide logo -->
  <div class="header">
    <img src="./ti_logo.png" alt="Transients & Incantations logo">
    <p class="tagline">Generative ideas for electronic music</p>
  </div>

  <!-- Mode selector -->
  <div class="mode-options">
    <label><input type="radio" name="mode" value="mystical" checked> Mystical</label>
    <label><input type="radio" name="mode" value="normal"> Normal</label>
  </div>

  <!-- Generate button -->
  <button id="generateBtn">Generate Idea</button>

  <!-- Idea panel -->
  <div id="idea-box">
    <div id="idea">Loading vocabulary…</div>
    <div class="actions">
      <button id="shareBtn" title="Download as Image">📷</button>
      <button id="copyBtn" title="Copy to Clipboard">📋</button>
    </div>
  </div>

  <!-- Footer with Ko-fi & License -->
  <footer>
    <div class="donate-widget" style="margin-bottom:15px;">
      <script src="https://storage.ko-fi.com/cdn/widget/Widget_2.js"></script>
      <script>
        kofiwidget2.init('Support me on Ko-fi', '#242524', 'V7V01ICB2V');
        kofiwidget2.draw();
      </script>
    </div>
    Concept &amp; Design by Chris van der Linden. Licensed under
    <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
  </footer>

  <!-- Generator script (unchanged) -->
  <script>
    let pool;
    fetch('/pool.json')
      .then(r=>r.ok? r.json(): Promise.reject('pool.json not found'))
      .then(data=>{pool=data; initApp()})
      .catch(e=>{document.getElementById('idea').innerText='⚠️ '+e; console.error(e)});

    function initApp(){
    const templates = [
  "As {subject} {verb}, {twist}.",
  "{subject} {verb} {metaphor}, {twist}.",
  "In the patchwork of {metaphor}, {subject} {verb}.",
  "{subject} {verb}—{twist}.",
  "{subject} {verb} {metaphor}.",
  "Nothing remains but {subject} that {verb} {metaphor}.",
  "{subject} begins again, {twist}.",
  "{subject} {verb} not in time, but in resonance.",
  "Each pulse {verb} {metaphor}, a memory in delay.",
  "{subject} becomes {twist}."
];

      const pick=a=>a[Math.floor(Math.random()*a.length)];
      const genMyst=()=>{ let t=pick(templates);
        return t.replace('{subject}',pick(pool.subjects))
                .replace('{verb}',pick(pool.verbs))
                .replace('{metaphor}',pick(pool.metaphors))
                .replace('{twist}',pick(pool.twists));
      };
      const genNorm=()=> 'Normal mode under revision.';
      const animateText=txt=>{
        const box=document.getElementById('idea');
        box.innerHTML='';
        [...txt].forEach((c,i)=>{
          let s=document.createElement('span');
          s.textContent=c; s.className='char';
          s.style.animationDelay=(i*20)+'ms';
          box.appendChild(s);
        });
      };
      const downloadImage=()=>{
        /* …your existing canvas+logo code… */
      };
      document.getElementById('generateBtn').onclick=_=>{
        let m=document.querySelector('input[name="mode"]:checked').value;
        animateText(m==='mystical'? genMyst(): genNorm());
      };
      document.getElementById('shareBtn').onclick=downloadImage;
      document.getElementById('copyBtn').onclick=_=>{
        let t=document.getElementById('idea').innerText;
        navigator.clipboard.writeText(t).then(()=>{
          let b=document.getElementById('copyBtn');
          b.textContent='✅'; setTimeout(()=>b.textContent='📋',1200);
        });
      };
      animateText(genMyst());
    }
  </script>
</body>
</html>
