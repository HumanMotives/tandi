<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transients &amp; Incantations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200&display=swap" rel="stylesheet">
  <style>
    
    body{margin:0;padding:20px;background:#F8FFF4;color:#474350;font-family:'Inter',sans-serif;font-weight:200;text-align:center;}
    img.logo{max-width:200px;margin-bottom:10px;}
    .mode-options{margin-bottom:0px;}
    .mode-options label{font-size:1.1em;margin:0 10px;}
    
  button {
    /* default button styles (not used by these three) */
  }

  /* Generate button */
  #generateBtn {
    background-color: #242524;
    color: #f7fff4;
  }
  #generateBtn:hover {
    background-color: #3a3b3a;
  }

  /* Save Image (ðŸ“·) button */
  #shareBtn {
    background-color: #FECDAA;
    color: #474350;
  }
  #shareBtn:hover {
    background-color: #e0c29a;
  }

  /* Copy to Clipboard (ðŸ“‹) button */
  #copyBtn {
    background-color: #474350;
    color: #F8FFF4;
  }
  #copyBtn:hover {
    background-color: #2e2d2f;
  }


    
    #idea-box{max-width:600px;margin:20px auto;position:relative;}
   #idea {
  font-size: 20px;
  white-space: normal;         /* wrap at spaces */
  overflow-wrap: break-word;
  word-wrap: break-word;
  hyphens: auto;
  /* â€¦the rest of your existing stylesâ€¦ */
     
}

  /* NEW: allow wrapping only at spaces */
  white-space: normal;
  overflow-wrap: break-word;
  word-wrap: break-word;
  hyphens: auto;
}
    #shareBtn,#copyBtn{margin-top:10px;}
    @keyframes fadeInChars{from{opacity:0;transform:translateY(.2em);}to{opacity:1;transform:translateY(0);}}
   .char {
  display: inline;            /* allow normal wrapping */
  opacity: 0;
  animation: fadeInChars .4s forwards;
  margin-right: .05em;        /* small spacing between letters */
  color: #474350;
}

    footer {
  margin-top: 30px;
  font-size: 0.8em;
  background: #ffffff;               /* white background */
  color: #474350;                    /* keep your brand text color */
  padding: 20px;                     /* inner spacing */
  border-radius: 8px;                /* rounded corners */
  max-width: 600px;                  /* align with #idea-box width */
  margin-left: auto;
  margin-right: auto;                /* center horizontally */
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
footer a {
  color: #474350;                    /* link color */
  text-decoration: underline;
}

  </style>
</head>
<body>
  <!-- Logo -->
  <img src="./ti_logo.png" class="logo" alt="Transients & Incantations logo">

  <!-- Mode -->
  <div class="mode-options">
    <label><input type="radio" name="mode" value="mystical" checked> Mystical</label>
    <label><input type="radio" name="mode" value="normal"> Normal</label>
  </div>

  <!-- Generate -->
  <button id="generateBtn">Generate</button>

  <!-- Result -->
  <div id="idea-box">
    <div id="idea">Loading vocabularyâ€¦</div>
  </div>

  <!-- Actions -->
  <button id="shareBtn">ðŸ“·</button>
  <button id="copyBtn">ðŸ“‹</button>
  
  <footer>
  <!-- Ko-fi Donate Widget -->
  <div class="donate-widget" style="margin-bottom:15px;">
    <script src="https://storage.ko-fi.com/cdn/widget/Widget_2.js"></script>
    <script>
      kofiwidget2.init('Support me on Ko-fi', '#969696', 'V7V01ICB2V');
      kofiwidget2.draw();
    </script>
  </div>

  <!-- License & Credit -->
  <div>
    Concept &amp; Design by Chris van der Linden. Licensed under
    <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
  </div>
</footer>


  <!-- SCRIPT: load pool.json & init generator -->
  <script>
  let pool;

  // 1) Fetch the JSON from site root
  fetch('/pool.json')
    .then(r => {
      if (!r.ok) throw new Error('pool.json not found');
      return r.json();
    })
    .then(data => {
      pool = data;
      initApp();
    })
    .catch(err => {
      document.getElementById('idea').innerText = 'âš ï¸ ' + err.message;
      console.error(err);
    });

  function initApp() {
    const templates = [
      "As {subject} {verb}, {twist}.",
      "{subject} {verb} {metaphor}, {twist}.",
      "In the patchwork of {metaphor}, {subject} {verb}.",
      "{subject} {verb}â€”{twist}.",
      "{subject} {verb} {metaphor}.",
      "Nothing remains but {subject} that {verb} {metaphor}.",
      "{subject} begins again, {twist}.",
      "{subject} {verb} not in time, but in resonance.",
      "Each pulse {verb} {metaphor}, a memory in delay.",
      "{subject} becomes {twist}."
    ];

    function pick(a){ return a[Math.floor(Math.random()*a.length)]; }
    function genMyst() {
      const t = pick(templates);
      return t
        .replace('{subject}', pick(pool.subjects))
        .replace('{verb}',    pick(pool.verbs))
        .replace('{metaphor}',pick(pool.metaphors))
        .replace('{twist}',   pick(pool.twists));
    }
    function genNorm() {
      return 'Normal mode under revision.';
    }

    function animateText(txt) {
      const box = document.getElementById('idea');
      box.innerHTML = '';
      [...txt].forEach((c,i) => {
        const s = document.createElement('span');
        s.textContent = c;
        s.className = 'char';
        s.style.animationDelay = (i*20)+'ms';
        box.appendChild(s);
      });
    }

    function downloadImage() {
      const txt = document.getElementById('idea').innerText;
      const c = document.createElement('canvas'), W=1080, H=1080;
      c.width=W; c.height=H;
      const ctx = c.getContext('2d');
      ctx.fillStyle='#F8FFF4'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle='#474350'; ctx.font='36px sans-serif';
      ctx.textAlign='center'; ctx.textBaseline='top';
      const words = txt.split(' '), lines = [], lh=48;
      let line = '';
      words.forEach(w => {
        const test = line + w + ' ';
        if (ctx.measureText(test).width > W*0.8) {
          lines.push(line.trim());
          line = w + ' ';
        } else {
          line = test;
        }
      });
      if (line) lines.push(line.trim());
      let y = (H - lines.length*lh)/2;
      lines.forEach(l => {
        ctx.fillText(l, W/2, y);
        y += lh;
      });
      const logo = new Image();
      logo.src = './ti_logo.png';
      logo.onload = () => {
        ctx.drawImage(logo, W-180, H-180, 120, 120);
        const a = document.createElement('a');
        a.download = 'incantation.png';
        a.href = c.toDataURL();
        a.click();
      };
    }

    // Wire buttons
    document.getElementById('generateBtn').onclick = () => {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      animateText(mode === 'mystical' ? genMyst() : genNorm());
    };
    document.getElementById('shareBtn').onclick = downloadImage;
    document.getElementById('copyBtn').onclick = () => {
      const txt = document.getElementById('idea').innerText;
      navigator.clipboard.writeText(txt).then(() => {
        const b = document.getElementById('copyBtn');
        b.textContent = 'âœ…';
        setTimeout(() => b.textContent = 'ðŸ“‹', 1200);
      });
    };

    // First call
    animateText(genMyst());
  }
  </script>
</body>
</html>
