<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transients &amp; Incantations</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0; padding: 40px 20px;
      background: #F8FFF4;
      color: #474350;
      font-family: 'Inter', sans-serif;
      font-weight: 200;
      text-align: center;
    }
    img.logo {
      max-width: 180px; margin-bottom: 20px;
    }
    .mode-options {
      margin-bottom: 20px;
    }
    .mode-options label {
      font-size: 1.1em;
      margin: 0 10px;
    }
    button {
      font-size: 1em; padding: 10px 20px;
      margin: 10px;
      border: none; border-radius: 5px;
      background: #FECDAA; color: #474350;
      cursor: pointer;
      font-family: 'Inter', sans-serif; font-weight: 200;
    }
    #idea-box {
      max-width: 600px; margin: 20px auto;
      position: relative;
    }
    #idea {
      background: #FAFAC6;
      border-radius: 8px;
      padding: 1em; font-size: 1.2em;
      line-height: 1.6;
      min-height: 3em;
    }
    #copyBtn, #shareBtn {
      margin-top: 10px;
    }
    @keyframes fadeInChars {
      from { opacity: 0; transform: translateY(0.2em); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .char {
      display: inline-block; opacity: 0;
      animation: fadeInChars 0.4s forwards;
      margin-right: 0.05em; white-space: pre;
      color: #474350;
    }
    footer {
      margin-top: 30px; font-size: 0.8em;
    }
  </style>
</head>
<body>

  <!-- Logo -->
  <img src="ti_logo.png" class="logo" alt="Transients & Incantations logo">

  <!-- Mode selector -->
  <div class="mode-options">
    <label><input type="radio" name="mode" value="mystical" checked> Mystical</label>
    <label><input type="radio" name="mode" value="normal"> Normal</label>
  </div>

  <!-- Generate -->
  <button id="generateBtn">Generate Idea</button>

  <!-- Result -->
  <div id="idea-box">
    <div id="idea">Tap ‚ÄúGenerate‚Äù to begin.</div>
  </div>

  <!-- Actions -->
  <button id="shareBtn" title="Download as Image">üì∑</button>
  <button id="copyBtn" title="Copy to Clipboard">üìã</button>

  <!-- Donate -->
  <div style="margin-top:20px;">
    <form action="https://www.paypal.com/donate" method="post" target="_blank">
      <input type="hidden" name="hosted_button_id" value="YOUR_BUTTON_ID_HERE">
      <input type="submit" value="Donate ‚ù§Ô∏è" style="background:#FECDAA;color:#474350;">
    </form>
  </div>

  <!-- License -->
  <footer>
    Content generated by this tool is licensed under
    <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
  </footer>

  <!-- Script -->
  <script>
  // ‚Äî‚Äì‚Äì‚Äì‚Äì‚Äì Modular Mystical Engine (placeholder ~100 each) ‚Äì‚Äì‚Äì‚Äì‚Äì‚Äî
  const mysticalVocab = {
    subjects: Array.from({length:100},(_,i)=>"subject"+i),
    verbs:    Array.from({length:100},(_,i)=>"verb"+i),
    metaphors:Array.from({length:100},(_,i)=>"metaphor"+i),
    twists:   Array.from({length:100},(_,i)=>"twist"+i),
    templates:[
      "As {subject} {verb}, {twist}.",
      "{subject} {verb} {metaphor}, {twist}.",
      "In the patchwork of {metaphor}, {subject} {verb}.",
      "{subject} {verb}‚Äî{twist}.",
      "{subject} {verb} {metaphor}.",
      "Nothing remains but {subject} that {verb} {metaphor}.",
      "{subject} begins again, {twist}.",
      "{subject} {verb} not in time, but in resonance.",
      "Each pulse {verb} {metaphor}, a memory in delay.",
      "{subject} becomes {twist}."
    ]
  };

  // pick & generate
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function generateMystical(){
    const t = pick(mysticalVocab.templates);
    return t.replace("{subject}", pick(mysticalVocab.subjects))
            .replace("{verb}",    pick(mysticalVocab.verbs))
            .replace("{metaphor}",pick(mysticalVocab.metaphors))
            .replace("{twist}",   pick(mysticalVocab.twists));
  }
  function generateNormal(){
    return "Normal mode under revision.";
  }

  // render with fade
  function displayAnimatedText(txt){
    const box = document.getElementById("idea");
    box.innerHTML="";
    [...txt].forEach((c,i)=>{
      const s=document.createElement("span");
      s.textContent=c; s.className="char";
      s.style.animationDelay=(i*20)+"ms";
      box.appendChild(s);
    });
  }

  // download canvas image
  function downloadImageFromIdea(){
    const txt=document.getElementById("idea").innerText;
    const c=document.createElement("canvas"),W=1080,H=1080;
    c.width=W; c.height=H;
    const ctx=c.getContext("2d");
    ctx.fillStyle="#F8FFF4"; ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#474350";
    ctx.font="36px sans-serif"; ctx.textAlign="center"; ctx.textBaseline="top";
    const words=txt.split(" "),lines=[],lh=48;
    let ln="";
    for(let w of words){
      const t=ln+w+" ",tw=ctx.measureText(t).width;
      if(tw>W*0.8){ lines.push(ln.trim()); ln=w+" "; }
      else ln=t;
    }
    if(ln) lines.push(ln.trim());
    let y=(H-lines.length*lh)/2;
    lines.forEach(l=>{ctx.fillText(l,W/2,y); y+=lh;});
    const logo=new Image(); logo.src="ti_logo.png";
    logo.onload=()=>{
      ctx.drawImage(logo,W-180,H-180,120,120);
      const a=document.createElement("a");
      a.download="incantation.png"; a.href=c.toDataURL();
      a.click();
    };
  }

  // init
  document.addEventListener("DOMContentLoaded",()=>{
    const gen=document.getElementById("generateBtn"),
          share=document.getElementById("shareBtn"),
          copy=document.getElementById("copyBtn");
    // first load
    displayAnimatedText(generateMystical());
    // handlers
    gen.addEventListener("click", ()=>{
      const mode=document.querySelector('input[name="mode"]:checked').value;
      displayAnimatedText(mode==="mystical"? generateMystical(): generateNormal());
    });
    share.addEventListener("click", downloadImageFromIdea);
    copy.addEventListener("click", ()=>{
      const t=document.getElementById("idea").innerText;
      navigator.clipboard.writeText(t).then(()=>{
        copy.textContent="‚úÖ";
        setTimeout(()=>copy.textContent="üìã",1200);
      });
    });
  });
  </script>

</body>
</html>
