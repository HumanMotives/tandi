<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ghost Radio</title>
  <link rel="stylesheet" href="/styles/main.css">
  <style>
    body {
      font-family: var(--font-main, sans-serif);
      background: var(--background, #f5f4ed);
      color: var(--text-color, #111);
      text-align: center;
      padding: 2em;
    }

    h1 {
      font-size: 2em;
      margin-top: 2em;
      opacity: 0;
      transition: opacity 3s ease-in;
    }

    body.loaded h1 {
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Ghost Radio</h1>

  <script>
    const context = new (window.AudioContext || window.webkitAudioContext)();
    const soundFiles = ['sound1.wav', 'sound2.wav', 'sound3.wav', 'sound4.wav', 'sound5.wav','sound6.wav','sound7.wav'];

    function randomInRange(min, max) {
      return Math.random() * (max - min) + min;
    }

    async function playRandomLayer(file) {
      const response = await fetch(`/projects/ghostradio/sounds/${file}`);
      const arrayBuffer = await response.arrayBuffer();
      const buffer = await context.decodeAudioData(arrayBuffer);

      const source = context.createBufferSource();
      const gainNode = context.createGain();
      const filter = context.createBiquadFilter();

      source.buffer = buffer;
      source.loop = true;

      // Random pitch (playbackRate)
      source.playbackRate.value = randomInRange(0.9, 1.1);

      // Random start position and loop duration
      const duration = buffer.duration;
      const start = randomInRange(0, duration * 0.75);
      const loopLength = randomInRange(2, duration - start);
      source.loopStart = start;
      source.loopEnd = start + loopLength;

      // Random filter
      filter.type = 'lowpass';
      filter.frequency.value = randomInRange(300, 5000);

      source.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(context.destination);

      // Fade in volume
      gainNode.gain.setValueAtTime(0, context.currentTime);
      gainNode.gain.linearRampToValueAtTime(0.6, context.currentTime + 3);

      source.start(context.currentTime, start);
    }

    window.addEventListener('load', () => {
      document.body.classList.add('loaded');

      const selected = [];
      while (selected.length < 3) {
        const choice = soundFiles[Math.floor(Math.random() * soundFiles.length)];
        if (!selected.includes(choice)) selected.push(choice);
      }

      selected.forEach(file => {
        playRandomLayer(file);
      });
    });
  </script>
</body>
</html>
