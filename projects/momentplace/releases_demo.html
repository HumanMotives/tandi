<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M≈çme ‚Äî Releases</title>

  <style>
  :root{
    --max-width: 980px;
    --gap: 16px;
    --muted: #6d6d6d;
    --accent: #000;
    --bg: #ffffff;
    --platinum: #E9F3EF;  /* soft mint / very light */
    --sand: #F2EDE1;      /* sand tint for subtle depth */
    --lion: #A88D6F;      /* earthy accent for primary CTA and brand */
    --cadet-gray: #86A7A9;
    --radius: 12px;
    --shadow: 0 8px 28px rgba(0,0,0,0.06);
    font-family: "Helvetica Neue", Arial, sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:#111;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:24px 16px;
  }
  .container{max-width:var(--max-width);margin:0 auto}
  .site-header{margin-bottom:18px;text-align:center}
  .site-header h1{font-weight:700;margin-bottom:6px;color:var(--lion);font-size:36px}
  .site-header .lead{color:var(--muted);margin:0 auto 12px;font-size:15px;max-width:720px}

  /* masonry */
  .masonry{column-width: 240px; column-gap: var(--gap);}

  /* base card */
  .card{
    display:inline-block;
    width:100%;
    margin:0 0 var(--gap);
    background: #fff;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow:hidden;
    vertical-align:top;
  }

  /* HERO flip-card (first tile): uses front/back flip */
  .card--hero {
    display:inline-flex;
    width:100%;
    margin:0 0 var(--gap);
    border-radius:var(--radius);
    overflow:visible;
    justify-content:center;
  }

  .flip-card {
    width:100%;
    min-height:280px;
    max-width:520px;
    perspective: 1000px;
    margin:0 auto;
    border-radius:var(--radius);
  }

  .flip-card-inner {
    position:relative;
    width:100%;
    min-height:280px;
    border-radius:var(--radius);
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(.2,.9,.25,1);
    box-shadow: 0 10px 36px rgba(0,0,0,0.08);
  }

  .flip-card.is-flipped .flip-card-inner {
    transform: rotateY(180deg);
  }

  .flip-card-face {
    position:absolute;
    inset:0;
    backface-visibility: hidden;
    border-radius:var(--radius);
    padding:22px;
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
  }

  .flip-card-front {
    background: linear-gradient(180deg, var(--platinum) 0%, var(--sand) 100%);
    color: #111;
  }

  .flip-card-back {
    background: linear-gradient(180deg, #fff 0%, #fafafa 100%);
    transform: rotateY(180deg);
    color:#111;
    padding:18px;
  }

  .hero-inner{max-width:520px}
  /* slightly reduced brand size */
  .hero-brand{
    font-size:64px;
    line-height:0.95;
    letter-spacing:-0.02em;
    margin-bottom:6px;
    font-weight:700;
    color:var(--lion);
    font-family: "Helvetica Neue", Arial, sans-serif;
  }
  .hero-tag{
    font-size:15px;
    color:var(--muted);
    margin-bottom:10px;
  }

  .hero-desc {
    color:var(--muted);
    font-size:14px;
    margin: 10px 0 12px;
    line-height:1.45;
  }

  .hero-actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
  .hero-actions .btn{padding:12px 16px;border-radius:10px;font-weight:700;cursor:pointer;border:0}

  /* primary CTA earthy */
  .btn-primary {
    background: var(--lion);
    color: #fff;
    border: 1px solid rgba(0,0,0,0.06);
  }

  .btn-help {
    background: transparent;
    color: var(--cadet-gray);
    border: none;
    text-decoration: underline;
    cursor: pointer;
    font-weight: 600;
    padding: 8px 6px;
  }

  /* square cover images */
  .card img{
    width:100%;
    aspect-ratio: 1/1;
    height: auto;
    display:block;
    object-fit:cover;
  }

  .card-body{padding:12px}
  .card-title{font-weight:700;margin:0 0 6px;font-size:15px}
  .card-meta{color:var(--muted);font-size:13px;margin-bottom:10px}
  .card-actions{display:flex;gap:8px;justify-content:space-between;align-items:center}
  .btn{background:#000;color:#fff;border:0;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer}
  .btn-ghost{background:transparent;color:var(--muted);border:1px solid #eee;padding:6px 10px}

  .site-footer{margin-top:32px;color:var(--muted);font-size:13px;text-align:center;padding-bottom:40px}

  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px;z-index:2200}
  .modal[aria-hidden="false"]{display:flex}
  .modal-inner{max-width:760px;width:100%;background:#fff;border-radius:12px;padding:18px;box-shadow:0 20px 80px rgba(0,0,0,0.3);display:flex;gap:14px;position:relative}
  .modal-close{position:absolute;right:18px;top:18px;background:transparent;border:0;font-size:22px;color:#111;cursor:pointer}
  .modal-cover{width:220px;height:220px;object-fit:cover;border-radius:8px;flex-shrink:0}
  .modal-meta{flex:1}
  .muted{color:var(--muted)}
  .small{font-size:13px}

  @media (max-width:720px){
    .hero-brand{font-size:44px}
    .flip-card { min-height:220px; padding:0;}
    .masonry{column-width:160px}
    .flip-card-face { padding:14px; }
  }
  </style>
</head>
<body>
  <main class="container">
    <header class="site-header">
      <h1>M≈çme</h1>
      <p class="lead">tiny sound releases from where you are</p>
    </header>

    <section id="releasesGrid" class="masonry">
      <!-- HERO: static flip-card as first tile -->
      <article class="card card--hero" aria-label="Mome hero">
        <div class="flip-card" id="heroFlip">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-face flip-card-front" role="region" aria-labelledby="heroTitle">
              <div class="hero-inner">
                <div id="heroTitle" class="hero-brand">M≈çme</div>
                <div class="hero-tag">tiny sound releases from where you are</div>
                <p class="hero-desc">Capture three short audio moments from a place you love and publish a tiny, shareable micro-release. Listeners can browse and play without recording anything themselves.</p>

                <div class="hero-actions" style="margin-top:6px">
                  <button class="btn-primary" id="btnRecord">Record My Place</button>
                  <button class="btn-help" id="btnHelp">Help</button>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-face flip-card-back" role="region" aria-labelledby="heroHelpTitle" id="heroBack">
              <div style="max-width:480px;margin:0 auto">
                <h3 id="heroHelpTitle" style="margin:0 0 8px">How M≈çme works</h3>
                <p class="muted small" style="margin-bottom:10px">
                  1) Tap Record My Place to start the capture flow.  
                  2) Take a square photo, then record three short sounds (max 15s each).  
                  3) We lightly process the audio, render a continuous micro-release and you can publish it to the grid.
                </p>
                <p class="muted small">Tip: pick sounds close to you ‚Äî footsteps, distant chatter, wind ‚Äî they become the texture of your release.</p>
                <div style="margin-top:12px;text-align:center">
                  <button class="btn-help" id="btnBackClose">Close</button>
                </div>
              </div>
            </div>

          </div>
        </div>
      </article>

      <!-- other cards injected by JS below -->
    </section>

    <footer class="site-footer container"><small>Demo grid ‚Äî click a card to open a release. M≈çme focuses on short field recordings.</small></footer>
  </main>

  <!-- Modal player -->
  <div id="playerModal" class="modal" aria-hidden="true">
    <div class="modal-inner" role="dialog" aria-modal="true">
      <button class="modal-close" id="modalClose">√ó</button>
      <img id="modalCover" src="" alt="Cover" class="modal-cover">
      <div class="modal-meta">
        <h2 id="modalTitle">Title</h2>
        <p id="modalLocation" class="muted">Location</p>
        <p id="modalDate" class="muted small">Date</p>

        <audio id="modalAudio" controls preload="auto" style="width:100%;margin-top:10px"></audio>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <button id="btnLike" class="btn">‚ô° Like <span id="likeCount" style="margin-left:8px">0</span></button>
          <button id="btnShare" class="btn" style="background:#444">Share</button>
        </div>

        <p id="modalDesc" class="muted small" style="margin-top:12px"></p>
      </div>
    </div>
  </div>

  <script>
  // expanded demo dataset (square-friendly covers)
  const DUMMY = [
    { id:'r1', title:'Morning Pool', location:'Casteren, NL', date:'2025-01-10T09:12:00Z', cover:'https://images.unsplash.com/photo-1503435824048-a799a3a84f9e?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Short ambient capture of sunlight and kids playing.', likes:12 },
    { id:'r2', title:'Dune Walk', location:'California, USA', date:'2025-01-05T18:30:00Z', cover:'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Wind and footsteps on sand.', likes:23 },
    { id:'r3', title:'Night Tram', location:'Amsterdam, NL', date:'2025-01-20T21:15:00Z', cover:'https://images.unsplash.com/photo-1482192596544-9eb780fc7f66?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Low hum and passing announcements.', likes:3 },
    { id:'r4', title:'Forest Shimmer', location:'Unknown', date:'2024-12-29T07:00:00Z', cover:'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Leaves, birds and distant water.', likes:9 },
    { id:'r5', title:'Kitchen Window', location:'Tilburg, NL', date:'2025-02-02T11:00:00Z', cover:'https://images.unsplash.com/photo-1501386763603-4f4a7418b1c6?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Morning kettle and distant city noise.', likes:5 },
    { id:'r6', title:'Atlantic Breeze', location:'Zeeland, NL', date:'2024-11-19T15:20:00Z', cover:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Waves and gulls.', likes:8 },
    { id:'r7', title:'Factory Door', location:'Eindhoven, NL', date:'2025-01-12T14:00:00Z', cover:'https://images.unsplash.com/photo-1505765056529-44d88a6f32d6?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Metal clinks and distant voices.', likes:7 },
    { id:'r8', title:'Quiet Alley', location:'Gent, BE', date:'2024-10-01T09:15:00Z', cover:'https://images.unsplash.com/photo-1475688621402-4257b0886b3f?auto=format&crop=entropy&w=800&h=800&q=60', audio:'https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3', description:'Bicycle bells and distant chat.', likes:4 }
  ];

  // helpers
  function fmtDate(iso){
    const d = new Date(iso);
    return d.toLocaleDateString(undefined,{ year:'numeric', month:'short', day:'numeric'});
  }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, t=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[t])); }

  const grid = document.getElementById('releasesGrid');

  // render the other cards AFTER the hero (hero is in markup)
  function renderCards(list){
    list.forEach(r=>{
      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        <img loading="lazy" src="${r.cover}" alt="${escapeHtml(r.title)}">
        <div class="card-body">
          <div class="card-title">${escapeHtml(r.title)}</div>
          <div class="card-meta">${escapeHtml(r.location)} ‚Ä¢ ${fmtDate(r.date)}</div>
          <div class="card-actions">
            <button class="btn btn-open" data-id="${r.id}">Luister</button>
            <div><button class="btn-ghost btn-like" data-id="${r.id}">‚ô° <span class="count">${r.likes}</span></button></div>
          </div>
        </div>
      `;
      grid.appendChild(el);
    });
  }

  // flip card wiring
  const heroFlip = document.getElementById('heroFlip');
  const btnHelp = document.getElementById('btnHelp');
  const btnBackClose = document.getElementById('btnBackClose');

  function flipHero(on){
    if(on) heroFlip.classList.add('is-flipped');
    else heroFlip.classList.remove('is-flipped');
  }
  btnHelp.addEventListener('click', ()=> flipHero(true));
  btnBackClose.addEventListener('click', ()=> flipHero(false));

  // Record button wiring
  document.getElementById('btnRecord').addEventListener('click', (e) => {
    // dispatch a namespaced event so your app can catch it cleanly
    const ev = new Event('mome:startCapture', { bubbles: true });
    document.dispatchEvent(ev);

    // fallback: try to trigger existing welcomeCreateBtn
    const welcomeStart = document.getElementById('welcomeCreateBtn');
    if (welcomeStart) {
      welcomeStart.click();
      return;
    }

    // fallback: hide main container grid and show camera container if present
    const cameraSection = document.getElementById('cameraContainer');
    if (cameraSection) {
      // hide the grid / header visually
      const parent = document.querySelector('main') || document.querySelector('.container');
      if (parent) parent.style.display = 'none';

      // reveal camera section and scroll into view
      cameraSection.style.display = 'flex';
      cameraSection.scrollIntoView({behavior:'smooth', block:'start'});

      // try to focus the enable camera button so user sees where to act
      setTimeout(()=>{
        const captureBtn = document.getElementById('captureBtn') || document.getElementById('enableCameraBtn');
        if (captureBtn) {
          captureBtn.hidden = false;
          captureBtn.textContent = 'üì∑ Enable Camera';
          captureBtn.focus({preventScroll:false});
        }
      }, 300);

      return;
    }

    // final fallback message
    alert('Start capture flow: camera UI niet gevonden. Zorg dat cameraContainer aanwezig is in de DOM.');
  });

  // modal logic
  const modal = document.getElementById('playerModal');
  const modalClose = document.getElementById('modalClose');
  const modalTitle = document.getElementById('modalTitle');
  const modalLocation = document.getElementById('modalLocation');
  const modalDate = document.getElementById('modalDate');
  const modalCover = document.getElementById('modalCover');
  const modalAudio = document.getElementById('modalAudio');
  const modalDesc = document.getElementById('modalDesc');
  const btnLike = document.getElementById('btnLike');
  const btnShare = document.getElementById('btnShare');
  const likeCountSpan = document.getElementById('likeCount');

  let currentRecord = null;

  function openById(id){
    const r = DUMMY.find(x=>x.id===id);
    if(!r) return;
    currentRecord = r;
    modal.setAttribute('aria-hidden','false');
    modalTitle.textContent = r.title;
    modalLocation.textContent = r.location;
    modalDate.textContent = fmtDate(r.date);
    modalCover.src = r.cover;
    modalDesc.textContent = r.description || '';
    modalAudio.src = r.audio;
    likeCountSpan.textContent = getLikes(r.id);
    modalAudio.currentTime = 0;
    modalAudio.play().catch(()=>{/* ignore autoplay errors */});
    document.body.style.overflow = 'hidden';
  }

  function closeModal(){
    modalAudio.pause();
    modalAudio.src = '';
    modal.setAttribute('aria-hidden','true');
    currentRecord = null;
    document.body.style.overflow = '';
  }

  modalClose.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{
    if(e.target === modal) closeModal();
  });

  // likes using localStorage
  function getLikes(id){
    const saved = localStorage.getItem('likes_' + id);
    if(saved !== null) return Number(saved);
    const r = DUMMY.find(x=>x.id===id);
    return r ? (r.likes || 0) : 0;
  }
  function setLikes(id, n){
    localStorage.setItem('likes_' + id, String(n));
  }

  // delegation
  document.addEventListener('click',(ev)=>{
    const openBtn = ev.target.closest('.btn-open');
    if(openBtn){ openById(openBtn.dataset.id); return; }
    const likeBtn = ev.target.closest('.btn-like');
    if(likeBtn){
      const id = likeBtn.dataset.id;
      const current = getLikes(id);
      const next = current + 1;
      setLikes(id, next);
      likeBtn.querySelector('.count').textContent = next;
      return;
    }
  });

  btnLike.addEventListener('click', ()=>{
    if(!currentRecord) return;
    const id = currentRecord.id;
    const current = getLikes(id);
    const next = current + 1;
    setLikes(id, next);
    likeCountSpan.textContent = next;
    const btn = document.querySelector(`.btn-like[data-id="${id}"]`);
    if(btn) btn.querySelector('.count').textContent = next;
  });

  btnShare.addEventListener('click', async ()=>{
    if(!currentRecord) return;
    const url = location.href.split('#')[0] + '#release=' + currentRecord.id;
    if(navigator.share){
      try{
        await navigator.share({ title: currentRecord.title, text: `Luister: ${currentRecord.title}`, url });
      }catch(e){ /* cancelled */ }
    } else {
      try{
        await navigator.clipboard.writeText(url);
        alert('Link gekopieerd naar klembord');
      }catch(e){
        prompt('Kopieer deze link', url);
      }
    }
  });

  document.addEventListener('keydown',(e)=>{
    if(e.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') closeModal();
  });

  // initial render
  renderCards(DUMMY);
  </script>
</body>
</html>
